{% extends "base.html" %}

{% block content %}
<section class="hero">
  <div>
    <h1>系统设置</h1>
    <p>配置访问密码、提醒通道与汇率服务。</p>
  </div>
</section>

<section class="settings-grid">
  <article class="panel">
    <h2>访问密码</h2>
    <form method="post" class="form">
      <input type="hidden" name="action" value="password">
      <label>
        当前密码
        <input type="password" name="current_password" required>
      </label>
      <label>
        新密码
        <input type="password" name="new_password" required>
      </label>
      <label>
        确认新密码
        <input type="password" name="confirm_password" required>
      </label>
      <button type="submit" class="btn primary">更新密码</button>
    </form>
  </article>

  <article class="panel">
    <h2>默认提醒</h2>
    <form method="post" class="form">
      <input type="hidden" name="action" value="preferences">
      <label>
        默认提前天数
        <input type="number" name="default_reminder_days" value="{{ settings.default_reminder_days }}">
      </label>
      <button type="submit" class="btn primary">保存</button>
    </form>
  </article>

  <article class="panel">
    <h2>Telegram 通道</h2>
    <form method="post" class="form">
      <input type="hidden" name="action" value="tg">
      <label class="checkbox">
        <input type="checkbox" name="tg_enabled" {% if settings.tg_enabled|int == 1 %}checked{% endif %}>
        启用 TG 提醒
      </label>
      <label>
        Bot Token
        <input type="text" name="tg_bot_token" value="{{ settings.tg_bot_token }}">
      </label>
      <label>
        Chat ID
        <input type="text" name="tg_chat_id" value="{{ settings.tg_chat_id }}">
      </label>
      <div class="inline-actions">
        <button type="submit" class="btn primary">保存 TG 配置</button>
      </div>
    </form>
    <form method="post" class="inline-form">
      <input type="hidden" name="action" value="test">
      <input type="hidden" name="channel" value="tg">
      <button type="submit" class="btn ghost">测试 TG</button>
    </form>
  </article>

  <article class="panel">
    <h2>邮件通道</h2>
    <form method="post" class="form">
      <input type="hidden" name="action" value="email">
      <label class="checkbox">
        <input type="checkbox" name="email_enabled" {% if settings.email_enabled|int == 1 %}checked{% endif %}>
        启用邮件提醒
      </label>
      <label>
        SMTP Host
        <input type="text" name="smtp_host" value="{{ settings.smtp_host }}">
      </label>
      <label>
        SMTP Port
        <input type="number" name="smtp_port" value="{{ settings.smtp_port }}">
      </label>
      <label>
        SMTP User
        <input type="text" name="smtp_user" value="{{ settings.smtp_user }}">
      </label>
      <label>
        SMTP Password
        <input type="password" name="smtp_password" value="{{ settings.smtp_password }}">
      </label>
      <label>
        Sender
        <input type="text" name="smtp_sender" value="{{ settings.smtp_sender }}">
      </label>
      <label class="checkbox">
        <input type="checkbox" name="smtp_tls" {% if settings.smtp_tls|int == 1 %}checked{% endif %}>
        使用 STARTTLS
      </label>
      <div class="inline-actions">
        <button type="submit" class="btn primary">保存邮件配置</button>
      </div>
    </form>
    <form method="post" class="inline-form">
      <input type="hidden" name="action" value="test">
      <input type="hidden" name="channel" value="email">
      <button type="submit" class="btn ghost">测试邮件</button>
    </form>
  </article>

  <article class="panel">
    <h2>汇率服务</h2>
    <form method="post" class="form">
      <input type="hidden" name="action" value="fx">
      <label>
        API 地址
        <input type="text" name="fx_api_url" value="{{ settings.fx_api_url }}">
      </label>
      <div class="hint">上次更新：{{ settings.fx_last_updated or "未更新" }}</div>
      <button type="submit" class="btn primary">立即更新汇率</button>
    </form>
  </article>
</section>
{% endblock %}
